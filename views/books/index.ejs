<form action="/books" method="GET" class="mb-4 d-flex w-100">
  <div class="d-flex align-items-center w-100">
    <label for="searchTitle" class="col-form-label me-3">Search</label>

    <div class="flex-grow-1 me-3">
      <input
        type="text"
        name="title"
        id="searchTitle"
        class="form-control w-100"
        value="<%= locals.searchOptions ? searchOptions.title : '' %>"
      />
    </div>

    <div>
      <button type="submit" class="btn btn-info text-white">Search</button>
    </div>
  </div>
</form>
<div class="d-flex justify-content-between align-items-center mb-2">
  <h2>All Books</h2>
  <div class="btn-group" role="group">
    <a
      href="/books?sort=title&dir=asc&title=<%= locals.searchOptions ? searchOptions.title : '' %>"
      class="btn btn-sm btn-outline-secondary <%= locals.searchOptions && locals.searchOptions.sort === 'title' && locals.searchOptions.dir === 'asc' ? 'active' : '' %>"
      title="Sort Title A-Z"
    >
      Title (A-Z)
    </a>

    <a
      href="/books?sort=title&dir=desc&title=<%= locals.searchOptions ? searchOptions.title : '' %>"
      class="btn btn-sm btn-outline-secondary <%= locals.searchOptions && locals.searchOptions.sort === 'title' && locals.searchOptions.dir === 'desc' ? 'active' : '' %>"
      title="Sort Title Z-A"
    >
      Title (Z-A)
    </a>
  </div>
</div>

<div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
  <% books.forEach(book => { %>

  <div>
    <div class="card h-100 shadow-">
      <% if (book.coverImagePath) { %>
      <a href="/books/<%= book.id %>">
        <img
          src="<%= book.coverImagePath %>"
          class="card-img-top"
          alt="<%= book.title %> Cover"
          style="height: 300px; object-fit: cover"
        />
      </a>
      <% } %>

      <div class="card-body d-flex flex-column">
        <h5 class="card-title">
          <a href="/books/<%= book.id %>" class="text-decoration-none"
            ><%= book.title %></a
          >
        </h5>

        <p class="card-text small text-muted mt-auto">
          Published: <%= book.publishDate ?
          book.publishDate.toLocaleDateString('en-US', { year: 'numeric', month:
          'short', day: 'numeric' }) : 'N/A' %>
        </p>
      </div>
    </div>
  </div>
  <% }) %>
</div>

<% const titleParam = locals.searchOptions ? searchOptions.title : ''; const
sortParam = locals.searchOptions ? searchOptions.sort : ''; const dirParam =
locals.searchOptions ? searchOptions.dir : ''; const currentPage =
locals.currentPage || 1; const totalPages = locals.totalPages || 1; const
totalBooks = locals.totalBooks || 0; const getPaginationLink = (page) => { let
link = `/books?page=${page}`; if (titleParam) link += `&title=${titleParam}`; if
(sortParam) link += `&sort=${sortParam}&dir=${dirParam}`; return link; }; %>

<div class="mt-4">
  <% if (totalPages > 1) { %>
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
        <a
          class="page-link"
          href="<%= getPaginationLink(currentPage - 1) %>"
          aria-label="Previous"
        >
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>

      <% const maxPagesToShow = 5; let startPage = Math.max(1, currentPage -
      Math.floor(maxPagesToShow / 2)); let endPage = Math.min(totalPages,
      startPage + maxPagesToShow - 1); if (endPage - startPage < maxPagesToShow
      - 1) { startPage = Math.max(1, endPage - maxPagesToShow + 1); } %> <% for
      (let i = startPage; i <= endPage; i++) { %>
      <li class="page-item <%= i === currentPage ? 'active' : '' %>">
        <a class="page-link" href="<%= getPaginationLink(i) %>"> <%= i %> </a>
      </li>
      <% } %>

      <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
        <a
          class="page-link"
          href="<%= getPaginationLink(currentPage + 1) %>"
          aria-label="Next"
        >
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
  <% } %>
</div>
